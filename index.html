<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Colin!</title>
    <link rel="stylesheet" type="text/css" href="./styles.css">  
</head>
<body>
    <div class="floating-hearts" id="hearts"></div>

    <section class="section hero">
        <div>
            <h1>Happy Birthday Colin!</h1>
            <p>A special day for the most special person</p>
        </div>
        <div class="scroll-indicator">
            <div>‚Üì Please scroll to explore your card ‚Üì</div>
        </div>
    </section>

    <section class="parallax-container memory-1">
        <div class="parallax-bg"></div>
        <div class="parallax-content">
            <div class="content-card">
                <h2>Big 21???</h2>
                <p>
                    Firstly, I hope that you feel incredibly loved today by everyone around you! I made this card that doesn't go against anything we agreed to hahahahahahaha!!! 
                    In all seriousness, I wanted to express my excitement for you in a way that makes you happy and I thought this was the best way. Continue scrolling to
                    see everything I want to express to you and the gifts I want to give you ü©∑
                </p>
                <button class="music-button">Click Me for the vibes!</button>
            </div>
        </div>
    </section>

    <section class="carousel-section">
        <div class="carousel-container">
            <h2 class="carousel-title">Our Beautiful Memories</h2>
            <main class="carousel-main">
                <ul class='slider'>
                  <li class='item' style="background-image: url('images/3.JPG')">
                    <div class='content'>
                      <h2 class='title'>"Peaceful Moments"</h2>
                      <p class='description'>When I am around you, I feel an overwhelming sense of peace that I haven't felt in a long time.</p>
                      <button>Remember This</button>
                    </div>
                  </li>
                  <li class='item' style="background-image: url('images/4.JPG')">
                    <div class='content'>
                      <h2 class='title'>"Crazy Discipline"</h2>
                      <p class='description'>A challenge never stops you but that's the point, and that thinking will move mountains, I am just waiting for the world to realize it too.</p>
                      <button>Remember This</button>
                    </div>
                  </li>
                  <li class='item' style="background-image: url('images/2.jpg')">
                    <div class='content'>
                      <h2 class='title'>"Beauty Everywhere"</h2>
                      <p class='description'>You have this amazing ability to find innovation and beauty in everything around us. Through your eyes, I see the world in a different light.</p>
                      <button>Remember This</button>
                    </div>
                  </li>
                  <li class='item' style="background-image: url('images/1.jpg')">
                    <div class='content'>
                      <h2 class='title'>"Dreamy Destinations"</h2>
                      <p class='description'>Somehow we are just always exploring and I have done more in the past 2 months than I did the whole year and it's always better with you around!!!</p>
                      <button>Remember This</button>
                    </div>
                  </li> 
                  <li class='item' style="background-image: url('images/9.JPG')">
                    <div class='content'>
                      <h2 class='title'>"Meaningful Connection"</h2>
                      <p class='description'>It's very easy to believe in beautiful souls when you exist. You offer kindness and help like the sun offers light.</p>
                      <button>Remember This</button>  
                    </div>
                  </li>
                  <li class='item' style="background-image: url('images/8.JPG')">
                    <div class='content'>
                      <h2 class='title'>"Your Confidence"</h2>
                      <p class='description'>I feel inspired by the confidence you have to do anything scared, doing it slightly uncomfortable, but just doing it even if you don't know how it will go.</p>
                      <button>Remember This</button>
                    </div>
                  </li>
                </ul>
                <nav class='nav'>
                  <ion-icon class='btn prev' name="arrow-back-outline"></ion-icon>
                  <ion-icon class='btn next' name="arrow-forward-outline"></ion-icon>
                </nav>
            </main>
        </div>
    </section>

    <section class="parallax-container memory-2">
        <div class="parallax-bg"></div>
        <div class="parallax-content">
            <div class="content-card">
                <h2>Your Passions</h2>
                <p>I have never met someone with so many hobbies and sub-processes like you and it never fails to excite me seeing the passion in your eyes with every new tool you decide to pick up.</p>
            </div>
        </div>
    </section>

    <section class="parallax-container memory-3">
        <div class="parallax-bg"></div>
        <div class="parallax-content">
            <div class="content-card">
                <h2>Your Kindness</h2>
                <p>
                    "Love is patient, love is kind.." 1 Corinthians 13:4 
                    That is exactly who you are, and you make me more patient and kinder and feel your spirit fully which I am grateful for. I hope that never changes and I help you to stay that way.
                </p>
            </div>
        </div>
    </section>

    <section class="letter-section">
        <div class="letter">
            <h2>Dear Colin,</h2>
            <p>
                I know that you don't necessarily love to celebrate today and I hope that I can honor your wishes while still showing you that there is some joy to this.
            </p>
            
            <p>
                I am so, so, so grateful to have you in my life. You bring laughter, smiles, joy, light and love into my life and those around you. I have always had love within me but being
                around you helps me to show it when I never could and it grows deeper every day. 
            </p>
            
            <p>
                Even during hard moments, you perservere with a smile on your face and that strength is very inspiring. Your spirit is so contagious and being able to witness you pursue your passions and dreams with dedication is inspiring. 
                While the world hasn't seen your full potential, I see it in you and I am excited with what you will do with it. 
            </p>
            
            <p>
                So, here's to another year of amazing memories, play time with your dogs, inside jokes, seafood boils, and all the little moments that make life so special. You deserve all the happiness and success in the world, Happy Birthday!
            </p>
            
            <div class="signature">With all my love,<br>Linda ‚ù§Ô∏è</div>
        </div>
    </section>

    <section class="cake-section">
        <div class="cake-container">
            <h2 class="cake-title">Make a Wish!</h2>
            <div class="cake">
                <div class="cake-layer cake-bottom">
                    <div class="frosting"></div>
                </div>
                <div class="cake-layer cake-middle">
                    <div class="frosting"></div>
                </div>
                <div class="cake-layer cake-top">
                    <div class="frosting"></div>
                    <div class="candles">
                        <div class="candle">
                            <div class="flame"></div>
                        </div>
                        <div class="candle">
                            <div class="flame"></div>
                        </div>
                        <div class="candle">
                            <div class="flame"></div>
                        </div>
                        <div class="candle">
                            <div class="flame"></div>
                        </div>
                        <div class="candle">
                            <div class="flame"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="audio-controls">
                <button class="audio-btn" id="blowBtn">üé§ Blow Out the Candles!</button>
                <div class="volume-indicator">
                    <div class="volume-bar" id="volumeBar"></div>
                </div>
                <p class="instructions">Click the button and blow into your microphone to make a wish!</p>
            </div>
        </div>
    </section>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    
    <!-- Birthday Card Modal -->
    <div id="birthdayCardModal" class="birthday-card-modal">
        <div class="birthday-card-content">
            <button class="close-modal" id="closeCardModal">&times;</button>
            <h2>üòõ Surprise! üéâ</h2>
            <img src="images/car.jpg" alt="Birthday Car Gift" class="birthday-card-image">
            <p>Wishing you another year of adventure, happiness, love and of course your orange Honda Civic Type R!</p>
        </div>
    </div>

    <!-- Hidden audio for kyle background music -->
    <audio id="mainSong" src="music/mainSong.mp3" loop></audio>

    <script>
        // Parallax effect for entire window
        window.addEventListener('scroll', () => {
            const scrolled = window.pageYOffset;
            const parallaxElements = document.querySelectorAll('.parallax-bg');
            
            parallaxElements.forEach(element => {
                const speed = 0.5;
                const yPos = -(scrolled * speed);
                element.style.transform = `translate3d(0, ${yPos}px, 0)`;
            });
        });

        // Intersection observer for the animations
        const observerOptions = {
            threshold: 0.3,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        // Observes all content cards and letter
        document.querySelectorAll('.content-card, .letter, .cake-container, .carousel-container').forEach(el => {
            observer.observe(el);
        });

        // Carousel functionality
        const slider = document.querySelector('.slider');
        
        function activate(e) {
            const items = document.querySelectorAll('.carousel-section .item');
            e.target.matches('.next') && slider.append(items[0])
            e.target.matches('.prev') && slider.prepend(items[items.length-1]);
        }

        document.addEventListener('click', activate, false);

        // Audio recognition for candle blowing
        let mediaRecorder;
        let audioContext;
        let analyser;
        let dataArray;
        let isListening = false;
        let candlesBlown = false;

        const blowBtn = document.getElementById('blowBtn');
        const volumeBar = document.getElementById('volumeBar');
        const flames = document.querySelectorAll('.flame');

        blowBtn.addEventListener('click', toggleListening);

        async function toggleListening() {
            if (!isListening) {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    startListening(stream);
                } catch (err) {
                    alert('Please allow microphone access to blow out the candles!');
                }
            } else {
                stopListening();
            }
        }

        function startListening(stream) {
            isListening = true;
            blowBtn.textContent = 'üé§ Listening... Blow now!';
            blowBtn.classList.add('listening');

            // Create audio context and analyser
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);

            analyser.fftSize = 256;
            const bufferLength = analyser.frequencyBinCount;
            dataArray = new Uint8Array(bufferLength);

            // Start monitoring audio levels
            monitorAudio();

            // Store stream for cleanup
            blowBtn.stream = stream;
        }

        function stopListening() {
            isListening = false;
            blowBtn.textContent = 'üé§ Blow Out the Candles!';
            blowBtn.classList.remove('listening');
            
            if (blowBtn.stream) {
                blowBtn.stream.getTracks().forEach(track => track.stop());
            }
            if (audioContext) {
                audioContext.close();
            }
        }

        function monitorAudio() {
            if (!isListening) return;

            analyser.getByteFrequencyData(dataArray);
            
            // Calculate volume level
            let sum = 0;
            for (let i = 0; i < dataArray.length; i++) {
                sum += dataArray[i];
            }
            const average = sum / dataArray.length;
            const volume = (average / 255) * 100;

            // Updates volume bar
            volumeBar.style.width = volume + '%';

            // Check if volume is high enough (blowing sound)
            if (volume > 20 && !candlesBlown) {
                blowOutCandles();
            }

            // Continue monitoring
            requestAnimationFrame(monitorAudio);
        }

        function blowOutCandles() {
            candlesBlown = true;
            
            // blow out candles with delay
            flames.forEach((flame, index) => {
                setTimeout(() => {
                    flame.classList.add('blown');
                }, index * 200);
            });

            // shows wish message and then show birthday card modal
            setTimeout(() => {
                const wishMessage = document.createElement('div');
                wishMessage.className = 'wish-message';
                //wishMessage.textContent = '‚ú® Make a Wish! ‚ú®';
                document.querySelector('.cake-section').appendChild(wishMessage);
                
                // show the birthday card modal after a short delay
                setTimeout(() => {
                    document.getElementById('birthdayCardModal').style.display = 'flex';
                    stopListening();
                }, 1500);
            }, 1000);
        }

        // Floating hearts animation
        function createHeart() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = '‚ô•';
            heart.style.left = Math.random() * 100 + '%';
            heart.style.animationDelay = Math.random() * 3 + 's';
            heart.style.animationDuration = (Math.random() * 3 + 4) + 's';
            document.getElementById('hearts').appendChild(heart);

            // removes heart after animation
            setTimeout(() => {
                heart.remove();
            }, 7000);
        }

        // creates hearts periodically
        setInterval(createHeart, 2000);

        // Smooth scrolling for better experience
        document.documentElement.style.scrollBehavior = 'smooth';

        // Modal close logic
        document.getElementById('closeCardModal').addEventListener('click', function() {
            document.getElementById('birthdayCardModal').style.display = 'none';
        });

        // Music button functionality
        const musicButton = document.querySelector('.music-button');
        const mainSong = document.getElementById('mainSong');
        let isMusicPlaying = false;

        if (musicButton && mainSong) {
            musicButton.addEventListener('click', async function() {
                if (!isMusicPlaying) {
                    try {
                        await mainSong.play();
                        isMusicPlaying = true;
                        musicButton.textContent = '‚è∏ Pause the vibes';
                        musicButton.classList.add('playing');
                    } catch (e) {
                        alert('Unable to play music. Please interact with the page or check your browser settings.');
                    }
                } else {
                    mainSong.pause();
                    isMusicPlaying = false;
                    musicButton.textContent = '‚ñ∂Ô∏è Click Me for the vibes!';
                    musicButton.classList.remove('playing');
                }
            });
        }
    </script>
</body>
</html>